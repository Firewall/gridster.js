/*
 gridster.js - v0.7.0 - 2017-03-27
 https://dsmorse.github.io/gridster.js/
 Copyright (c) 2017 ducksboard; Licensed MIT */
(function(e,b){"object"===typeof exports?module.exports=b(require("jquery")):"function"===typeof define&&define.amd?define("gridster-coords",["jquery"],b):e.GridsterCoords=b(e.$||e.jQuery)})(this,function(e){function b(b){b[0]&&e.isPlainObject(b[0])?this.data=b[0]:this.el=b;this.isCoords=!0;this.coords={};this.init();return this}var v=b.prototype;v.init=function(){this.set();this.original_coords=this.get()};v.set=function(e,b){var t=this.el;t&&!e&&(this.data=t.offset(),this.data.width=t.width(),this.data.height=
t.height());if(t&&e&&!b){var l=t.offset();this.data.top=l.top;this.data.left=l.left}l=this.data;void 0===l.left&&(l.left=l.x1);void 0===l.top&&(l.top=l.y1);this.coords.x1=l.left;this.coords.y1=l.top;this.coords.x2=l.left+l.width;this.coords.y2=l.top+l.height;this.coords.cx=l.left+l.width/2;this.coords.cy=l.top+l.height/2;this.coords.width=l.width;this.coords.height=l.height;this.coords.el=t||!1;return this};v.update=function(b){if(!b&&!this.el)return this;if(b)return this.data=e.extend({},this.data,
b),this.set(!0,!0);this.set(!0);return this};v.get=function(){return this.coords};v.destroy=function(){this.el.removeData("coords");delete this.el};e.fn.coords=function(){if(this.data("coords"))return this.data("coords");var e=new b(this);this.data("coords",e);return e};return b});
(function(e,b){"object"===typeof exports?module.exports=b(require("jquery")):"function"===typeof define&&define.amd?define("gridster-collision",["jquery","gridster-coords"],b):e.GridsterCollision=b(e.$||e.jQuery,e.GridsterCoords)})(this,function(e,b){function v(b,l,a){this.options=e.extend(m,a);this.$element=b;this.last_colliders=[];this.last_colliders_coords=[];this.set_colliders(l);this.init()}var m={colliders_context:document.body,overlapping_region:"C"};v.defaults=m;var r=v.prototype;r.init=function(){this.find_collisions()};
r.overlaps=function(e,b){var a=!1,c=!1;if(b.x1>=e.x1&&b.x1<=e.x2||b.x2>=e.x1&&b.x2<=e.x2||e.x1>=b.x1&&e.x2<=b.x2)a=!0;if(b.y1>=e.y1&&b.y1<=e.y2||b.y2>=e.y1&&b.y2<=e.y2||e.y1>=b.y1&&e.y2<=b.y2)c=!0;return a&&c};r.detect_overlapping_region=function(e,b){var a="",c="";e.y1>b.cy&&e.y1<b.y2&&(a="N");e.y2>b.y1&&e.y2<b.cy&&(a="S");e.x1>b.cx&&e.x1<b.x2&&(c="W");e.x2>b.x1&&e.x2<b.cx&&(c="E");return a+c||"C"};r.calculate_overlapped_area_coords=function(b,l){var a=Math.max(b.x1,l.x1),c=Math.max(b.y1,l.y1);return e({left:a,
top:c,width:Math.min(b.x2,l.x2)-a,height:Math.min(b.y2,l.y2)-c}).coords().get()};r.calculate_overlapped_area=function(e){return e.width*e.height};r.manage_colliders_start_stop=function(b,l,a){for(var c=this.last_colliders_coords,d=0,f=c.length;d<f;d++)-1===e.inArray(c[d],b)&&l.call(this,c[d]);l=0;for(d=b.length;l<d;l++)-1===e.inArray(b[l],c)&&a.call(this,b[l])};r.find_collisions=function(b){var l=this.options.overlapping_region,a=[],c=[],d=this.colliders||this.$colliders,f=d.length;for(b=this.$element.coords().update(b||
!1).get();f--;){var h=this.$colliders?e(d[f]):d[f],k=h.isCoords?h:h.coords(),g=k.get();if(this.overlaps(b,g)){var q=this.detect_overlapping_region(b,g);if(q===l||"all"===l){var u=this.calculate_overlapped_area_coords(b,g),p=this.calculate_overlapped_area(u);0!==p&&(h={area:p,area_coords:u,region:q,coords:g,player_coords:b,el:h},this.options.on_overlap&&this.options.on_overlap.call(this,h),a.push(k),c.push(h))}}}(this.options.on_overlap_stop||this.options.on_overlap_start)&&this.manage_colliders_start_stop(a,
this.options.on_overlap_start,this.options.on_overlap_stop);this.last_colliders_coords=a;return c};r.get_closest_colliders=function(e){e=this.find_collisions(e);e.sort(function(e,a){return"C"===e.region&&"C"===a.region?e.coords.y1<a.coords.y1||e.coords.x1<a.coords.x1?-1:1:1});return e};r.set_colliders=function(b){"string"===typeof b||b instanceof e?this.$colliders=e(b,this.options.colliders_context).not(this.$element):this.colliders=e(b)};e.fn.collision=function(e,b){return new v(this,e,b)};return v});
(function(e,b){e.delay=function(e,b){var m=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return e.apply(null,m)},b)};e.debounce=function(e,b,r){var m;return function(){var l=this,a=arguments;r&&!m&&e.apply(l,a);clearTimeout(m);m=setTimeout(function(){m=null;r||e.apply(l,a)},b)}};e.throttle=function(e,b){var m,t,l,a,c,d,f=debounce(function(){c=a=!1},b);return function(){m=this;t=arguments;l||(l=setTimeout(function(){l=null;c&&e.apply(m,t);f()},b));a?c=!0:d=e.apply(m,t);f();a=
!0;return d}}})(window);
(function(e,b){"object"===typeof exports?module.exports=b(require("jquery")):"function"===typeof define&&define.amd?define("gridster-draggable",["jquery"],b):e.GridsterDraggable=b(e.$||e.jQuery)})(this,function(e){function b(a,d){this.options=e.extend({},v,d);this.$document=e(document);this.$container=e(a);this.$scroll_container=this.options.scroll_container===window?e(window):this.$container.closest(this.options.scroll_container);this.is_dragging=!1;this.player_min_left=0+this.options.offset_left;
this.player_min_top=0+this.options.offset_top;this.id=++l+"";this.ns=".gridster-draggable-"+this.id;this.init()}var v={items:"li",distance:1,limit:{width:!0,height:!1},offset_left:0,autoscroll:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:!0,helper:!1,remove_helper:!0},m=e(window),r={x:"left",y:"top"},t=!!("ontouchstart"in window),l=0;b.defaults=v;var a=b.prototype;a.init=function(){var a=this.$container.css("position");this.calculate_dimensions();
this.$container.css("position","static"===a?"relative":a);this.disabled=!1;this.events();m.bind(this.nsEvent("resize"),throttle(e.proxy(this.calculate_dimensions,this),200))};a.nsEvent=function(a){return(a||"")+this.ns};a.events=function(){this.pointer_events={start:this.nsEvent("touchstart")+" "+this.nsEvent("mousedown"),move:this.nsEvent("touchmove")+" "+this.nsEvent("mousemove"),end:this.nsEvent("touchend")+" "+this.nsEvent("mouseup")};this.$container.on(this.nsEvent("selectstart"),e.proxy(this.on_select_start,
this));this.$container.on(this.pointer_events.start,this.options.items,e.proxy(this.drag_handler,this));this.$document.on(this.pointer_events.end,e.proxy(function(a){this.is_dragging=!1;if(!this.disabled&&(this.$document.off(this.pointer_events.move),this.drag_start))this.on_dragstop(a)},this))};a.get_actual_pos=function(a){return a.position()};a.get_mouse_pos=function(a){a.originalEvent&&a.originalEvent.touches&&(a=a.originalEvent,a=a.touches.length?a.touches[0]:a.changedTouches[0]);return{left:a.clientX,
top:a.clientY}};a.get_offset=function(a){a.preventDefault();a=this.get_mouse_pos(a);var c=Math.round(a.left-this.mouse_init_pos.left),f=Math.round(a.top-this.mouse_init_pos.top),e=Math.round(this.el_init_offset.left+c-this.baseX+this.$scroll_container.scrollLeft()-this.scroll_container_offset_x),b=Math.round(this.el_init_offset.top+f-this.baseY+this.$scroll_container.scrollTop()-this.scroll_container_offset_y);this.options.limit.width&&(e>this.player_max_left?e=this.player_max_left:e<this.player_min_left&&
(e=this.player_min_left));this.options.limit.height&&(b>this.player_max_top?b=this.player_max_top:b<this.player_min_top&&(b=this.player_min_top));return{position:{left:e,top:b},pointer:{left:a.left,top:a.top,diff_left:c+(this.$scroll_container.scrollLeft()-this.scroll_container_offset_x),diff_top:f+(this.$scroll_container.scrollTop()-this.scroll_container_offset_y)}}};a.get_drag_data=function(a){a=this.get_offset(a);a.$player=this.$player;a.$helper=this.helper?this.$helper:this.$player;return a};
a.set_limits=function(a){a||(a=this.$container.width());this.player_max_left=a-this.player_width+-this.options.offset_left;this.player_max_top=this.options.container_height-this.player_height+-this.options.offset_top;this.options.container_width=a;return this};a.scroll_in=function(a,d){var c=r[a],e="scroll"+(c.charAt(0).toUpperCase()+c.slice(1)),b="x"===a,g=b?this.scroller_width:this.scroller_height;var q=this.$scroll_container===window?b?this.$scroll_container.width():this.$scroll_container.height():
b?this.$scroll_container[0].scrollWidth:this.$scroll_container[0].scrollHeight;var u=b?this.$player.width():this.$player.height();b=this.$scroll_container[e]();var p=b+50;c=b+d.pointer[c];q=q-g+u;c>=b+g-50&&(g=b+30,g<q&&(this.$scroll_container[e](g),this["scroll_offset_"+a]+=30));c<=p&&(g=b-30,0<g&&(this.$scroll_container[e](g),this["scroll_offset_"+a]-=30));return this};a.manage_scroll=function(a){this.scroll_in("x",a);this.scroll_in("y",a)};a.calculate_dimensions=function(){this.scroller_height=
this.$scroll_container.height();this.scroller_width=this.$scroll_container.width()};a.drag_handler=function(a){if(!this.disabled&&(1===a.which||t)&&!this.ignore_drag(a)){var c=this,f=!0;this.$player=e(a.currentTarget);this.el_init_pos=this.get_actual_pos(this.$player);this.mouse_init_pos=this.get_mouse_pos(a);this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top;this.$document.on(this.pointer_events.move,function(a){var d=c.get_mouse_pos(a),e=Math.abs(d.top-c.mouse_init_pos.top);if(!(Math.abs(d.left-
c.mouse_init_pos.left)>c.options.distance||e>c.options.distance))return!1;if(f)return f=!1,c.on_dragstart.call(c,a),!1;!0===c.is_dragging&&c.on_dragmove.call(c,a);return!1});if(!t)return!1}};a.on_dragstart=function(a){a.preventDefault();if(this.is_dragging)return this;this.drag_start=this.is_dragging=!0;var c=this.$container.offset();this.baseX=Math.round(c.left);this.baseY=Math.round(c.top);"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),
this.helper=!0):this.helper=!1;this.scroll_container_offset_y=this.$scroll_container.scrollTop();this.scroll_container_offset_x=this.$scroll_container.scrollLeft();this.el_init_offset=this.$player.offset();this.player_width=this.$player.width();this.player_height=this.$player.height();this.set_limits(this.options.container_width);this.options.start&&this.options.start.call(this.$player,a,this.get_drag_data(a));return!1};a.on_dragmove=function(a){var c=this.get_drag_data(a);this.options.autoscroll&&
this.manage_scroll(c);this.options.move_element&&(this.helper?this.$helper:this.$player).css({position:"absolute",left:c.position.left,top:c.position.top});c.prev_position=this.last_position||c.position;this.options.drag&&this.options.drag.call(this.$player,a,c);this.last_position=c.position;return!1};a.on_dragstop=function(a){var c=this.get_drag_data(a);this.drag_start=!1;this.options.stop&&this.options.stop.call(this.$player,a,c);this.helper&&this.options.remove_helper&&this.$helper.remove();return!1};
a.on_select_start=function(a){if(!this.disabled&&!this.ignore_drag(a))return!1};a.enable=function(){this.disabled=!1};a.disable=function(){this.disabled=!0};a.destroy=function(){this.disable();this.$container.off(this.ns);this.$document.off(this.ns);m.off(this.ns);e.removeData(this.$container,"drag")};a.ignore_drag=function(a){return this.options.handle?!e(a.target).is(this.options.handle):e.isFunction(this.options.ignore_dragging)?this.options.ignore_dragging(a):this.options.resize?!e(a.target).is(this.options.items):
e(a.target).is(this.options.ignore_dragging.join(", "))};e.fn.gridDraggable=function(a){return new b(this,a)};e.fn.dragg=function(a){return this.each(function(){e.data(this,"drag")||e.data(this,"drag",new b(this,a))})};return b});
(function(e,b){"object"===typeof exports?module.exports=b(require("jquery"),require("./jquery.draggable.js"),require("./jquery.collision.js"),require("./jquery.coords.js"),require("./utils.js")):"function"===typeof define&&define.amd?define(["jquery","gridster-draggable","gridster-collision"],b):e.Gridster=b(e.$||e.jQuery,e.GridsterDraggable,e.GridsterCollision)})(this,function(e,b,v){function m(a,c){this.options=e.extend(!0,{},l,c);this.options.draggable=this.options.draggable||{};this.options.draggable=
e.extend(!0,{},this.options.draggable,{scroll_container:this.options.scroll_container});this.$el=e(a);this.$scroll_container=this.options.scroll_container===window?e(window):this.$el.closest(this.options.scroll_container);this.$wrapper=this.$el.parent();this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w");this.$changed=e([]);this.w_queue={};this.is_responsive()?this.min_widget_width=this.get_responsive_col_width():this.min_widget_width=this.options.widget_base_dimensions[0];
this.min_widget_height=this.options.widget_base_dimensions[1];this.is_resizing=!1;this.prev_col_count=this.min_col_count=this.options.min_cols;this.generated_stylesheets=[];this.$style_tags=e([]);"boolean"===typeof this.options.limit&&(console.log("limit: bool is deprecated, consider using limit: { width: boolean, height: boolean} instead"),this.options.limit={width:this.options.limit,height:this.options.limit});this.options.auto_init&&this.init()}function r(a){for(var c=["col","row","size_x","size_y"],
d={},f=0,e=c.length;f<e;f++){var b=c[f];if(!(b in a))throw Error("Not exists property `"+b+"`");var g=a[b];if(!g||isNaN(g))throw Error("Invalid value of `"+b+"` property");d[b]=+g}return d}var t=e(window),l={namespace:"",widget_selector:"li",static_class:"static",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:Infinity,limit:{width:!0,height:!1},min_rows:1,max_rows:15,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,auto_init:!0,center_widgets:!1,
responsive_breakpoint:!1,scroll_container:window,shift_larger_widgets_down:!0,move_widgets_down_only:!1,shift_widgets_up:!0,show_element:function(a,c){c?a.fadeIn(c):a.fadeIn()},hide_element:function(a,c){c?a.fadeOut(c):a.fadeOut()},serialize_params:function(a,c){return{col:c.col,row:c.row,size_x:c.size_x,size_y:c.size_y}},collision:{wait_for_mouseup:!1},draggable:{items:".gs-w:not(.static)",distance:4,ignore_dragging:b.defaults.ignore_dragging.slice(0)},resize:{enabled:!1,axes:["both"],handle_append_to:"",
handle_class:"gs-resize-handle",max_size:[Infinity,Infinity],min_size:[1,1]},ignore_self_occupied:!1};m.defaults=l;m.generated_stylesheets=[];m.sort_by_row_asc=function(a){return a=a.sort(function(a,d){a.row||(a=e(a).coords().grid,d=e(d).coords().grid);a=r(a);d=r(d);return a.row>d.row?1:-1})};m.sort_by_row_and_col_asc=function(a){return a=a.sort(function(a,d){a=r(a);d=r(d);return a.row>d.row||a.row===d.row&&a.col>d.col?1:-1})};m.sort_by_col_asc=function(a){return a=a.sort(function(a,d){a=r(a);d=r(d);
return a.col>d.col?1:-1})};m.sort_by_row_desc=function(a){return a=a.sort(function(a,d){a=r(a);d=r(d);return a.row+a.size_y<d.row+d.size_y?1:-1})};b=m.prototype;b.init=function(){this.options.resize.enabled&&this.setup_resize();this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();this.$wrapper.addClass("ready");this.draggable();this.options.resize.enabled&&this.resizable();this.options.center_widgets&&setTimeout(e.proxy(function(){this.center_widgets()},
this),0);t.bind("resize.gridster",throttle(e.proxy(this.recalculate_faux_grid,this),200))};b.disable=function(){this.$wrapper.find(".player-revert").removeClass("player-revert");this.drag_api.disable();return this};b.enable=function(){this.drag_api.enable();return this};b.disable_resize=function(){this.$el.addClass("gs-resize-disabled");this.resize_api.disable();return this};b.enable_resize=function(){this.$el.removeClass("gs-resize-disabled");this.resize_api.enable();return this};b.add_widget=function(a,
c,d,f,b,k,g,q){c||(c=1);d||(d=1);if(f||b){var h={col:f,row:b,size_x:c,size_y:d};this.options.avoid_overlapped_widgets&&this.empty_cells(f,b,c,d)}else if(h=this.next_position(c,d),!1===h)return!1;a=e(a).attr({"data-col":h.col,"data-row":h.row,"data-sizex":c,"data-sizey":d}).addClass("gs-w").appendTo(this.$el).hide();this.$widgets=this.$widgets.add(a);this.$changed=this.$changed.add(a);this.register_widget(a);h=parseInt(h.row)+(parseInt(h.size_y)-1);this.rows<h&&this.add_faux_rows(h-this.rows);k&&this.set_widget_max_size(a,
k);g&&this.set_widget_min_size(a,g);this.set_dom_grid_width();this.set_dom_grid_height();this.drag_api.set_limits(this.cols*this.min_widget_width+(this.cols+1)*this.options.widget_margins[0]);this.options.center_widgets&&setTimeout(e.proxy(function(){this.center_widgets()},this),0);this.options.show_element.call(this,a,q);return a};b.set_widget_min_size=function(a,c){a="number"===typeof a?this.$widgets.eq(a):a;if(!a.length)return this;var d=a.data("coords").grid;d.min_size_x=c[0];d.min_size_y=c[1];
return this};b.set_widget_max_size=function(a,c){a="number"===typeof a?this.$widgets.eq(a):a;if(!a.length)return this;var d=a.data("coords").grid;d.max_size_x=c[0];d.max_size_y=c[1];return this};b.add_resize_handle=function(a){a=this.options.resize.handle_append_to?e(this.options.resize.handle_append_to,a):a;0===a.children("span[class~='"+this.resize_handle_class+"']").length&&e(this.resize_handle_tpl).appendTo(a);return this};b.resize_widget=function(a,c,d,f){var e=a.coords().grid;this.is_resizing=
!0;c||(c=e.size_x);d||(d=e.size_y);this.is_valid_row(e.row,d)||this.add_faux_rows(Math.max(this.calculate_highest_row(e.row,d)-this.rows,0));this.is_valid_col(e.col,d)||this.add_faux_cols(Math.max(this.calculate_highest_row(e.col,c)-this.cols,0));c={col:e.col,row:e.row,size_x:c,size_y:d};this.mutate_widget_in_gridmap(a,e,c);this.set_dom_grid_height();this.set_dom_grid_width();f&&f.call(this,c.size_x,c.size_y);this.is_resizing=!1;return a};b.expand_widget=function(a,c,d,f,b){var h=a.coords().grid,
g=Math.floor((e(window).width()-2*this.options.widget_margins[0])/this.min_widget_width);c=c||Math.min(g,this.cols);d||(d=h.size_y);g=h.size_y;a.attr("pre_expand_col",h.col);a.attr("pre_expand_sizex",h.size_x);a.attr("pre_expand_sizey",h.size_y);f=f||1;d>g&&this.add_faux_rows(Math.max(d-g,0));c={col:f,row:h.row,size_x:c,size_y:d};this.mutate_widget_in_gridmap(a,h,c);this.set_dom_grid_height();this.set_dom_grid_width();b&&b.call(this,c.size_x,c.size_y);return a};b.collapse_widget=function(a,c){var d=
a.coords().grid,e=parseInt(a.attr("pre_expand_sizex")),b=parseInt(a.attr("pre_expand_sizey"));e={col:parseInt(a.attr("pre_expand_col")),row:d.row,size_x:e,size_y:b};this.mutate_widget_in_gridmap(a,d,e);this.set_dom_grid_height();this.set_dom_grid_width();c&&c.call(this,e.size_x,e.size_y);return a};b.fit_to_content=function(a,c,d,e){var f=a.coords().grid,b=this.$wrapper.width(),g=this.$wrapper.height();c={col:f.col,row:f.row,size_x:Math.min(c,Math.ceil((b+2*this.options.widget_margins[0])/(this.options.widget_base_dimensions[0]+
2*this.options.widget_margins[0]))),size_y:Math.min(d,Math.ceil((g+2*this.options.widget_margins[1])/(this.options.widget_base_dimensions[1]+2*this.options.widget_margins[1])))};this.mutate_widget_in_gridmap(a,f,c);this.set_dom_grid_height();this.set_dom_grid_width();e&&e.call(this,c.size_x,c.size_y);return a};b.center_widgets=debounce(function(){var a=this.$wrapper.width();var c=this.is_responsive()?this.get_responsive_col_width():this.options.widget_base_dimensions[0]+2*this.options.widget_margins[0];
a=2*Math.floor(Math.max(Math.floor(a/c),this.min_col_count)/2);this.options.min_cols=a;this.options.max_cols=a;this.options.extra_cols=0;this.set_dom_grid_width(a);this.cols=a;var d=(a-this.prev_col_count)/2;0>d?(this.get_min_col()>-1*d?this.shift_cols(d):this.resize_widget_dimensions(this.options),setTimeout(e.proxy(function(){this.resize_widget_dimensions(this.options)},this),0)):0<d?(this.resize_widget_dimensions(this.options),setTimeout(e.proxy(function(){this.shift_cols(d)},this),0)):(this.resize_widget_dimensions(this.options),
setTimeout(e.proxy(function(){this.resize_widget_dimensions(this.options)},this),0));this.prev_col_count=a;return this},200);b.get_min_col=function(){return Math.min.apply(Math,this.$widgets.map(e.proxy(function(a,c){return this.get_cells_occupied(e(c).coords().grid).cols},this)).get())};b.shift_cols=function(a){var c=this.$widgets.map(e.proxy(function(a,c){var d=e(c);return this.dom_to_coords(d)},this));c=m.sort_by_row_and_col_asc(c);c.each(e.proxy(function(c,f){var d=e(f.el),b=d.coords().grid,g=
parseInt(d.attr("data-col")),q={col:Math.max(Math.round(g+a),1),row:b.row,size_x:b.size_x,size_y:b.size_y};setTimeout(e.proxy(function(){this.mutate_widget_in_gridmap(d,b,q)},this),0)},this))};b.mutate_widget_in_gridmap=function(a,c,d){var f=c.size_y,b=this.get_cells_occupied(c),k=this.get_cells_occupied(d),g=[];e.each(b.cols,function(a,c){-1===e.inArray(c,k.cols)&&g.push(c)});var q=[];e.each(k.cols,function(a,c){-1===e.inArray(c,b.cols)&&q.push(c)});var u=[];e.each(b.rows,function(a,c){-1===e.inArray(c,
k.rows)&&u.push(c)});var p=[];e.each(k.rows,function(a,c){-1===e.inArray(c,b.rows)&&p.push(c)});this.remove_from_gridmap(c);q.length&&this.empty_cells.apply(this,[d.col,d.row,d.size_x,Math.min(f,d.size_y),a]);p.length&&this.empty_cells.apply(this,[d.col,d.row,d.size_x,d.size_y,a]);c.col=d.col;c.row=d.row;c.size_x=d.size_x;c.size_y=d.size_y;this.add_to_gridmap(d,a);a.removeClass("player-revert");this.update_widget_dimensions(a,d);this.options.shift_widgets_up&&(g.length&&this.remove_empty_cells.apply(this,
[g[0],d.row,g[g.length-1]-g[0]+1,Math.min(f,d.size_y),a]),u.length&&this.remove_empty_cells.apply(this,[d.col,d.row,d.size_x,d.size_y,a]));this.move_widget_up(a);return this};b.empty_cells=function(a,c,d,f,b){this.widgets_below({col:a,row:c-f,size_x:d,size_y:f}).not(b).each(e.proxy(function(a,d){var b=e(d),h=b.coords().grid;h.row<=c+f-1&&this.move_widget_down(b,c+f-h.row)},this));this.is_resizing||this.set_dom_grid_height();return this};b.remove_empty_cells=function(a,c,d,f,b){this.widgets_below({col:a,
row:c,size_x:d,size_y:f}).not(b).each(e.proxy(function(a,c){this.move_widget_up(e(c),f)},this));this.set_dom_grid_height();return this};b.next_position=function(a,c){a||(a=1);c||(c=1);for(var d=this.gridmap,e=d.length,b=[],k,g=1;g<e;g++){k=d[g].length;for(var q=1;q<=k;q++)this.can_move_to({size_x:a,size_y:c},g,q)&&b.push({col:g,row:q,size_y:c,size_x:a})}return b.length?m.sort_by_row_and_col_asc(b)[0]:!1};b.remove_by_grid=function(a,c){var d=this.is_widget(a,c);d&&this.remove_widget(d)};b.remove_widget=
function(a,c,d){var f=a instanceof e?a:e(a);if(0===f.length)return this;var b=f.coords().grid;if(void 0===b)return this;e.isFunction(c)&&(d=c,c=!1);this.cells_occupied_by_placeholder={};this.$widgets=this.$widgets.not(f);var k=this.widgets_below(f);this.remove_from_gridmap(b);this.options.hide_element.call(this,f,e.proxy(function(){f.remove();c||k.each(e.proxy(function(a,c){this.move_widget_up(e(c),b.size_y)},this));this.set_dom_grid_height();d&&d.call(this,a)},this));return this};b.remove_all_widgets=
function(a){this.$widgets.each(e.proxy(function(c,d){this.remove_widget(d,!0,a)},this));return this};b.serialize=function(a){a||(a=this.$widgets);var c=[];a.each(e.proxy(function(a,b){var d=e(b);"undefined"!==typeof d.coords().grid&&c.push(this.options.serialize_params(d,d.coords().grid))},this));return c};b.serialize_changed=function(){return this.serialize(this.$changed)};b.dom_to_coords=function(a){return{col:parseInt(a.attr("data-col"),10),row:parseInt(a.attr("data-row"),10),size_x:parseInt(a.attr("data-sizex"),
10)||1,size_y:parseInt(a.attr("data-sizey"),10)||1,max_size_x:parseInt(a.attr("data-max-sizex"),10)||!1,max_size_y:parseInt(a.attr("data-max-sizey"),10)||!1,min_size_x:parseInt(a.attr("data-min-sizex"),10)||!1,min_size_y:parseInt(a.attr("data-min-sizey"),10)||!1,el:a}};b.register_widget=function(a){var c=a instanceof e,d=c?this.dom_to_coords(a):a,b=!1;c||(a=d.el);c=this.can_go_widget_up(d);this.options.shift_widgets_up&&c&&(d.row=c,a.attr("data-row",c),this.$el.trigger("gridster:positionchanged",
[d]),b=!0);this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:d.size_x,size_y:d.size_y},d.col,d.row)&&(e.extend(d,this.next_position(d.size_x,d.size_y)),a.attr({"data-col":d.col,"data-row":d.row,"data-sizex":d.size_x,"data-sizey":d.size_y}),b=!0);a.data("coords",a.coords());a.data("coords").grid=d;this.add_to_gridmap(d,a);this.update_widget_dimensions(a,d);this.options.resize.enabled&&this.add_resize_handle(a);return b};b.update_widget_position=function(a,c){this.for_each_cell_occupied(a,
function(a,e){if(!this.gridmap[a])return this;this.gridmap[a][e]=c});return this};b.update_widget_dimensions=function(a,c){var d=c.size_x*(this.is_responsive()?this.get_responsive_col_width():this.options.widget_base_dimensions[0])+(c.size_x-1)*this.options.widget_margins[0],e=c.size_y*this.options.widget_base_dimensions[1]+(c.size_y-1)*this.options.widget_margins[1];a.data("coords").update({width:d,height:e});a.attr({"data-col":c.col,"data-row":c.row,"data-sizex":c.size_x,"data-sizey":c.size_y});
return this};b.update_widgets_dimensions=function(){e.each(this.$widgets,e.proxy(function(a,c){var d=e(c).coords().grid;"object"===typeof d&&this.update_widget_dimensions(e(c),d)},this));return this};b.remove_from_gridmap=function(a){return this.update_widget_position(a,!1)};b.add_to_gridmap=function(a,c){this.update_widget_position(a,c||a.el)};b.draggable=function(){var a=this,c=e.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],
container_width:this.cols*this.min_widget_width+(this.cols+1)*this.options.widget_margins[0],container_height:this.rows*this.min_widget_height+(this.rows+1)*this.options.widget_margins[0],limit:{width:this.options.limit.width,height:this.options.limit.height},start:function(c,b){a.$widgets.filter(".player-revert").removeClass("player-revert");a.$player=e(this);a.$helper=e(b.$helper);a.helper=!a.$helper.is(a.$player);a.on_start_drag.call(a,c,b);a.$el.trigger("gridster:dragstart")},stop:function(c,
e){a.on_stop_drag.call(a,c,e);a.$el.trigger("gridster:dragstop")},drag:throttle(function(c,e){a.on_drag.call(a,c,e);a.$el.trigger("gridster:drag")},60)});this.drag_api=this.$el.dragg(c).data("drag")};b.resizable=function(){this.resize_api=this.$el.gridDraggable({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:!1,resize:!0,limit:{width:Infinity!==this.options.max_cols||this.limit.width,height:Infinity!==this.options.max_rows||
this.limit.height},scroll_container:this.options.scroll_container,start:e.proxy(this.on_start_resize,this),stop:e.proxy(function(a,c){delay(e.proxy(function(){this.on_stop_resize(a,c)},this),120)},this),drag:throttle(e.proxy(this.on_resize,this),60)});return this};b.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var a='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';this.resize_handle_tpl=e.map(this.options.resize.axes,function(c){return a.replace("{type}",
c)}).join("");e.isArray(this.options.draggable.ignore_dragging)&&this.options.draggable.ignore_dragging.push("."+this.resize_handle_class);return this};b.on_start_drag=function(a,c){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging");this.highest_col=this.get_highest_occupied_cell().col;this.$player.addClass("player");this.player_grid_data=this.$player.coords().grid;this.placeholder_grid_data=e.extend({},this.player_grid_data);this.get_highest_occupied_cell().row+this.player_grid_data.size_y<=
this.options.max_rows&&this.set_dom_grid_height(this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);this.set_dom_grid_width(this.cols);var d=this.player_grid_data.size_x,b=this.cols-this.highest_col;Infinity===this.options.max_cols&&b<=d&&this.add_faux_cols(Math.min(d-b,1));d=this.faux_grid;b=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);
this.last_cols=[];this.last_rows=[];this.collision_api=this.$helper.collision(d,this.options.collision);this.$preview_holder=e("<"+this.$player.get(0).tagName+" />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:b.width,height:b.height}}).appendTo(this.$el);this.options.draggable.start&&this.options.draggable.start.call(this,a,c)};b.on_drag=function(a,c){if(null===this.$player)return!1;var d=this.options.widget_margins,e=this.$preview_holder.attr("data-col"),
b=this.$preview_holder.attr("data-row");d={left:c.position.left+this.baseX-d[0]*e,top:c.position.top+this.baseY-d[1]*b};Infinity===this.options.max_cols&&(this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1>=this.cols-1&&this.options.max_cols>=this.cols+1&&(this.add_faux_cols(1),this.set_dom_grid_width(this.cols+1),this.drag_api.set_limits(this.cols*this.min_widget_width+(this.cols+1)*this.options.widget_margins[0])),this.collision_api.set_colliders(this.faux_grid));this.colliders_data=
this.collision_api.get_closest_colliders(d);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.helper&&this.$player&&this.$player.css({left:c.position.left,top:c.position.top});this.options.draggable.drag&&this.options.draggable.drag.call(this,a,c)};b.on_stop_drag=function(a,c){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging");var d=
this.options.widget_margins,e=this.$preview_holder.attr("data-col"),b=this.$preview_holder.attr("data-row");c.position.left=c.position.left+this.baseX-d[0]*e;c.position.top=c.position.top+this.baseY-d[1]*b;this.colliders_data=this.collision_api.get_closest_colliders(c.position);this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column);this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row);this.$changed=this.$changed.add(this.$player);
d=this.placeholder_grid_data.el.coords().grid;if(d.col!==this.placeholder_grid_data.col||d.row!==this.placeholder_grid_data.row)this.update_widget_position(d,!1),this.options.collision.wait_for_mouseup&&this.for_each_cell_occupied(this.placeholder_grid_data,function(a,c){if(this.is_widget(a,c)){var d=this.placeholder_grid_data.row+this.placeholder_grid_data.size_y,e=parseInt(this.gridmap[a][c][0].getAttribute("data-row"));d-=e;this.move_widget_down(this.is_widget(a,c),d)||this.set_placeholder(this.placeholder_grid_data.el.coords().grid.col,
this.placeholder_grid_data.el.coords().grid.row)}});this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data);d=this.placeholder_grid_data.col;e=this.placeholder_grid_data.row;this.set_cells_player_occupies(d,e);this.$player.coords().grid.row=e;this.$player.coords().grid.col=d;this.$player.addClass("player-revert").removeClass("player").attr({"data-col":d,"data-row":e}).css({left:"",top:""});this.options.draggable.stop&&this.options.draggable.stop.call(this,a,c);this.$preview_holder.remove();
this.$helper=this.$player=null;this.placeholder_grid_data={};this.player_grid_data={};this.cells_occupied_by_placeholder={};this.cells_occupied_by_player={};this.w_queue={};this.set_dom_grid_height();this.set_dom_grid_width();Infinity===this.options.max_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width+(this.cols+1)*this.options.widget_margins[0])};b.on_start_resize=function(a,c){this.$resized_widget=c.$player.closest(".gs-w");this.resize_coords=this.$resized_widget.coords();this.resize_wgd=
this.resize_coords.grid;this.resize_initial_width=this.resize_coords.coords.width;this.resize_initial_height=this.resize_coords.coords.height;this.resize_initial_sizex=this.resize_coords.grid.size_x;this.resize_initial_sizey=this.resize_coords.grid.size_y;this.resize_initial_col=this.resize_coords.grid.col;this.resize_last_sizex=this.resize_initial_sizex;this.resize_last_sizey=this.resize_initial_sizey;this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-
this.resize_initial_col+1);this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1];this.resize_min_size_x=this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1;this.resize_min_size_y=this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1;this.resize_initial_last_col=this.get_highest_occupied_cell().col;this.set_dom_grid_width(this.cols);this.resize_dir={right:c.$player.is("."+this.resize_handle_class+"-x"),bottom:c.$player.is("."+this.resize_handle_class+
"-y")};this.is_responsive()||this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var d=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=e("<"+d+" />",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el);this.$resized_widget.addClass("resizing");
this.options.resize.start&&this.options.resize.start.call(this,a,c,this.$resized_widget);this.$el.trigger("gridster:resizestart")};b.on_stop_resize=function(a,c){this.$resized_widget.removeClass("resizing").css({width:"",height:"","min-width":"","min-height":""});delay(e.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""});this.options.resize.stop&&this.options.resize.stop.call(this,a,c,this.$resized_widget);this.$el.trigger("gridster:resizestop")},this),300);
this.set_dom_grid_width();this.set_dom_grid_height();Infinity===this.options.max_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)};b.on_resize=function(a,c){var d=c.pointer.diff_left,e=c.pointer.diff_top,b=this.is_responsive()?this.get_responsive_col_width():this.options.widget_base_dimensions[0],k=this.options.widget_base_dimensions[1],g=this.options.widget_margins[0],q=this.options.widget_margins[1],u=this.resize_max_size_x,p=this.resize_min_size_x,n=this.resize_max_size_y,l=this.resize_min_size_y,
m=Infinity===this.options.max_cols,r=Math.max(1,this.resize_initial_sizex+Math.ceil(d/(b+2*g)-.2)),w=Math.max(1,this.resize_initial_sizey+Math.ceil(e/(k+2*q)-.2)),x=Math.floor(this.container_width/this.min_widget_width-this.resize_initial_col+1),t=x*this.min_widget_width+(x-1)*g;r=Math.max(Math.min(r,u),p);r=Math.min(x,r);u=Math.min(u*b+(r-1)*g,t);b=p*b+(r-1)*g;w=Math.max(Math.min(w,n),l);n=n*k+(w-1)*q;k=l*k+(w-1)*q;this.resize_dir.right?w=this.resize_initial_sizey:this.resize_dir.bottom&&(r=this.resize_initial_sizex);
m&&(q=this.resize_initial_col+r-1,m&&this.resize_initial_last_col<=q&&(this.set_dom_grid_width(Math.max(q+1,this.cols)),this.cols<q&&this.add_faux_cols(q-this.cols)));m={};!this.resize_dir.bottom&&(m.width=Math.max(Math.min(this.resize_initial_width+d,u),b));!this.resize_dir.right&&(m.height=Math.max(Math.min(this.resize_initial_height+e,n),k));this.$resized_widget.css(m);if(r!==this.resize_last_sizex||w!==this.resize_last_sizey)this.resize_widget(this.$resized_widget,r,w,!1),this.set_dom_grid_width(this.cols),
this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":r,"data-sizey":w});this.options.resize.resize&&this.options.resize.resize.call(this,a,c,this.$resized_widget);this.$el.trigger("gridster:resize");this.resize_last_sizex=r;this.resize_last_sizey=w};b.on_overlapped_column_change=function(a,c){if(!this.colliders_data.length)return this;var d=this.get_targeted_columns(this.colliders_data[0].el.data.col),b=this.last_cols.length,h=d.length,
k;for(k=0;k<h;k++)-1===e.inArray(d[k],this.last_cols)&&(a||e.noop).call(this,d[k]);for(k=0;k<b;k++)-1===e.inArray(this.last_cols[k],d)&&(c||e.noop).call(this,this.last_cols[k]);this.last_cols=d;return this};b.on_overlapped_row_change=function(a,c){if(!this.colliders_data.length)return this;var d=this.get_targeted_rows(this.colliders_data[0].el.data.row),b=this.last_rows.length,h=d.length,k;for(k=0;k<h;k++)-1===e.inArray(d[k],this.last_rows)&&(a||e.noop).call(this,d[k]);for(k=0;k<b;k++)-1===e.inArray(this.last_rows[k],
d)&&(c||e.noop).call(this,this.last_rows[k]);this.last_rows=d};b.set_player=function(a,c,d){var b=!1;a=d?{col:a}:this.colliders_data[0].el.data;var h=a.col,k=a.row||c;this.player_grid_data={col:h,row:k,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x};this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);var g=this.get_widgets_overlapped(this.player_grid_data),q=this.player_grid_data.size_y,
u=this.player_grid_data.size_x,p=this.cells_occupied_by_placeholder,n=this;g.each(e.proxy(function(a,c){var d=e(c),f=d.coords().grid,l=p.cols[0]+u-1,m=p.rows[0]+q-1;if(d.hasClass(n.options.static_class))return!0;if(n.options.collision.wait_for_mouseup&&n.drag_api.is_dragging)n.placeholder_grid_data.col=h,n.placeholder_grid_data.row=k,n.cells_occupied_by_placeholder=n.get_cells_occupied(n.placeholder_grid_data),n.$preview_holder.attr({"data-row":k,"data-col":h});else if(f.size_x<=u&&f.size_y<=q)if(n.is_swap_occupied(p.cols[0],
f.row,f.size_x,f.size_y)||n.is_player_in(p.cols[0],f.row)||n.is_in_queue(p.cols[0],f.row,d))if(n.is_swap_occupied(l,f.row,f.size_x,f.size_y)||n.is_player_in(l,f.row)||n.is_in_queue(l,f.row,d))if(n.is_swap_occupied(f.col,p.rows[0],f.size_x,f.size_y)||n.is_player_in(f.col,p.rows[0])||n.is_in_queue(f.col,p.rows[0],d))if(n.is_swap_occupied(f.col,m,f.size_x,f.size_y)||n.is_player_in(f.col,m)||n.is_in_queue(f.col,m,d))if(n.is_swap_occupied(p.cols[0],p.rows[0],f.size_x,f.size_y)||n.is_player_in(p.cols[0],
p.rows[0])||n.is_in_queue(p.cols[0],p.rows[0],d))for(m=0;m<u;m++)for(var r=0;r<q;r++){var t=p.cols[0]+m,v=p.rows[0]+r;if(!n.is_swap_occupied(t,v,f.size_x,f.size_y)&&!n.is_player_in(t,v)&&!n.is_in_queue(t,v,d)){b=n.queue_widget(t,v,d);m=u;break}}else n.options.move_widgets_down_only?g.each(e.proxy(function(a,c){var d=e(c);n.can_go_down(d)&&d.coords().grid.row===n.player_grid_data.row&&!n.is_in_queue(l,f.row,d)&&(n.move_widget_down(d,n.player_grid_data.size_y),n.set_placeholder(h,k))})):b=n.queue_widget(p.cols[0],
p.rows[0],d);else b=n.queue_widget(f.col,m,d);else b=n.queue_widget(f.col,p.rows[0],d);else b=n.queue_widget(l,f.row,d);else n.options.move_widgets_down_only?g.each(e.proxy(function(a,c){var d=e(c);n.can_go_down(d)&&d.coords().grid.row===n.player_grid_data.row&&!n.is_in_queue(d.coords().grid.col,f.row,d)&&(n.move_widget_down(d,n.player_grid_data.size_y),n.set_placeholder(h,k))})):b=n.queue_widget(p.cols[0],f.row,d);else n.options.shift_larger_widgets_down&&!b&&g.each(e.proxy(function(a,c){var d=e(c);
n.can_go_down(d)&&d.coords().grid.row===n.player_grid_data.row&&(n.move_widget_down(d,n.player_grid_data.size_y),n.set_placeholder(h,k))}));n.clean_up_changed()}));if(b&&this.can_placeholder_be_set(h,k,u,q)){for(var l in this.w_queue)c=parseInt(l.split("_")[0]),a=parseInt(l.split("_")[1]),"full"!==this.w_queue[l]&&this.new_move_widget_to(this.w_queue[l],c,a);this.set_placeholder(h,k)}g.length||(this.options.shift_widgets_up&&(l=this.can_go_player_up(this.player_grid_data),!1!==l&&(k=l)),this.can_placeholder_be_set(h,
k,u,q)&&this.set_placeholder(h,k));this.w_queue={};return{col:h,row:k}};b.is_swap_occupied=function(a,c,d,e){for(var b=!1,f=0;f<d;f++)for(var g=0;g<e;g++){var q=a+f,u=c+g,l=q+"_"+u;if(this.is_occupied(q,u))b=!0;else if(l in this.w_queue){if("full"===this.w_queue[l]){b=!0;continue}var n=this.w_queue[l].coords().grid;this.is_widget_under_player(n.col,n.row)||delete this.w_queue[l]}u>parseInt(this.options.max_rows)&&(b=!0);q>parseInt(this.options.max_cols)&&(b=!0);this.is_player_in(q,u)&&(b=!0)}return b};
b.can_placeholder_be_set=function(a,c,d,b){for(var e=!0,f=0;f<d;f++)for(var g=0;g<b;g++){var q=a+f,l=c+g,p=this.is_widget(q,l);l>parseInt(this.options.max_rows)&&(e=!1);q>parseInt(this.options.max_cols)&&(e=!1);this.is_occupied(q,l)&&!this.is_widget_queued_and_can_move(p)&&(e=!1)}return e};b.queue_widget=function(a,c,d){var b=d.coords().grid,e=a+"_"+c;if(e in this.w_queue)return!1;this.w_queue[e]=d;for(d=0;d<b.size_x;d++)for(var k=0;k<b.size_y;k++){var g=a+d+"_"+(c+k);g!==e&&(this.w_queue[g]="full")}return!0};
b.is_widget_queued_and_can_move=function(a){var c=!1;if(!1===a)return!1;for(var d in this.w_queue)if("full"!==this.w_queue[d]&&this.w_queue[d].attr("data-col")===a.attr("data-col")&&this.w_queue[d].attr("data-row")===a.attr("data-row")){c=!0;var b=this.w_queue[d],e=parseInt(d.split("_")[0]),k=parseInt(d.split("_")[1]);b=b.coords().grid;for(var g=0;g<b.size_x;g++)for(var q=0;q<b.size_y;q++)this.is_player_in(e+g,k+q)&&(c=!1)}return c};b.is_in_queue=function(a,c,d){var b=!1;a=a+"_"+c;a in this.w_queue&&
("full"===this.w_queue[a]?b=!0:(b=this.w_queue[a].coords().grid,this.is_widget_under_player(b.col,b.row)?this.w_queue[a].attr("data-col")===d.attr("data-col")&&this.w_queue[a].attr("data-row")===d.attr("data-row")?(delete this.w_queue[a],b=!1):b=!0:(delete this.w_queue[a],b=!1)));return b};b.widgets_constraints=function(a){var c=e([]),d=[],b=[];a.each(e.proxy(function(a,f){var g=e(f),h=g.coords().grid;this.can_go_widget_up(h)?(c=c.add(g),d.push(h)):b.push(h)},this));a.not(c);return{can_go_up:m.sort_by_row_asc(d),
can_not_go_up:m.sort_by_row_desc(b)}};b.manage_movements=function(a,c,d){e.each(a,e.proxy(function(a,b){var e=b.el,f=this.can_go_widget_up(b);f?(this.move_widget_to(e,f),this.set_placeholder(c,f+b.size_y)):this.can_go_player_up(this.player_grid_data)||(f=d+this.player_grid_data.size_y-b.row,this.can_go_down(e)&&(console.log("In Move Down!"),this.move_widget_down(e,f),this.set_placeholder(c,d)))},this));return this};b.is_player=function(a,c){if(c&&!this.gridmap[a])return!1;var d=c?this.gridmap[a][c]:
a;return d&&(d.is(this.$player)||d.is(this.$helper))};b.is_player_in=function(a,c){var d=this.cells_occupied_by_player||{};return 0<=e.inArray(a,d.cols)&&0<=e.inArray(c,d.rows)};b.is_placeholder_in=function(a,c){var d=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(a)&&0<=e.inArray(c,d.rows)};b.is_placeholder_in_col=function(a){return 0<=e.inArray(a,(this.cells_occupied_by_placeholder||[]).cols)};b.is_empty=function(a,c){return"undefined"!==typeof this.gridmap[a]?"undefined"!==
typeof this.gridmap[a][c]&&!1===this.gridmap[a][c]?!0:!1:!0};b.is_valid_col=function(a,c){return Infinity===this.options.max_cols?!0:this.cols>=this.calculate_highest_col(a,c)};b.is_valid_row=function(a,c){return this.rows>=this.calculate_highest_row(a,c)};b.calculate_highest_col=function(a,c){return a+(c||1)-1};b.calculate_highest_row=function(a,c){return a+(c||1)-1};b.is_occupied=function(a,c){return!this.gridmap[a]||this.is_player(a,c)?!1:this.gridmap[a][c]?this.options.ignore_self_occupied?this.$player.data()!==
e(this.gridmap[a][c]).data():!0:!1};b.is_widget=function(a,c){var d=this.gridmap[a];return d?(d=d[c])?d:!1:!1};b.is_static=function(a,c){var d=this.gridmap[a];return d?(d=d[c])&&d.hasClass(this.options.static_class)?!0:!1:!1};b.is_widget_under_player=function(a,c){return this.is_widget(a,c)?this.is_player_in(a,c):!1};b.get_widgets_under_player=function(a){a||(a=this.cells_occupied_by_player||{cols:[],rows:[]});var c=e([]);e.each(a.cols,e.proxy(function(d,b){e.each(a.rows,e.proxy(function(a,d){this.is_widget(b,
d)&&(c=c.add(this.gridmap[b][d]))},this))},this));return c};b.set_placeholder=function(a,c){var d=e.extend({},this.placeholder_grid_data),b=a+d.size_x-1;b>this.cols&&(a-=b-a);b=this.placeholder_grid_data.row<c;var h=this.placeholder_grid_data.col!==a;this.placeholder_grid_data.col=a;this.placeholder_grid_data.row=c;this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data);this.$preview_holder.attr({"data-row":c,"data-col":a});this.options.shift_player_up&&((b||h)&&this.widgets_below({col:d.col,
row:d.row,size_y:d.size_y,size_x:d.size_x}).each(e.proxy(function(a,c){var d=e(c),b=d.coords().grid;(b=this.can_go_widget_up(b))&&this.move_widget_to(d,b)},this)),b=this.get_widgets_under_player(this.cells_occupied_by_placeholder),b.length&&b.each(e.proxy(function(a,b){var f=e(b);this.move_widget_down(f,c+d.size_y-f.data("coords").grid.row)},this)))};b.can_go_player_up=function(a){var c=a.row+a.size_y-1,d=!0,b=[],e=1E4,k=this.get_widgets_under_player();this.for_each_column_occupied(a,function(a){var f=
this.gridmap[a],g=c+1;for(b[a]=[];0<--g;)if(this.is_empty(a,g)||this.is_player(a,g)||this.is_widget(a,g)&&f[g].is(k))b[a].push(g),e=g<e?g:e;else break;if(0===b[a].length)return d=!1,!0;b[a].sort(function(a,c){return a-c})});return d?this.get_valid_rows(a,b,e):!1};b.can_go_widget_up=function(a){var c=a.row+a.size_y-1,d=!0,b=[],e=1E4;this.for_each_column_occupied(a,function(f){var g=this.gridmap[f];b[f]=[];for(var h=c+1;0<--h&&(!this.is_widget(f,h)||this.is_player_in(f,h)||g[h].is(a.el));)this.is_player(f,
h)||this.is_placeholder_in(f,h)||this.is_player_in(f,h)||b[f].push(h),h<e&&(e=h);if(0===b[f].length)return d=!1,!0;b[f].sort(function(a,c){return a-c})});return d?this.get_valid_rows(a,b,e):!1};b.get_valid_rows=function(a,c,d){var b=a.row,h=a.row+a.size_y-1;a=a.size_y;var k=d-1;for(d=[];++k<=h;){var g=!0;e.each(c,function(a,c){e.isArray(c)&&-1===e.inArray(k,c)&&(g=!1)});if(!0===g&&(d.push(k),d.length===a))break}c=!1;1===a?d[0]!==b&&(c=d[0]||!1):d[0]!==b&&(c=this.get_consecutive_numbers_index(d,a));
return c};b.get_consecutive_numbers_index=function(a,c){for(var d=a.length,b=[],e=!0,k=-1,g=0;g<d;g++){if(e||a[g]===k+1){b.push(g);if(b.length===c)break;e=!1}else b=[],e=!0;k=a[g]}return b.length>=c?a[b[0]]:!1};b.get_widgets_overlapped=function(){var a=e([]),c=[],d=this.cells_occupied_by_player.rows.slice(0);d.reverse();e.each(this.cells_occupied_by_player.cols,e.proxy(function(b,h){e.each(d,e.proxy(function(d,b){if(!this.gridmap[h])return!0;var f=this.gridmap[h][b];this.is_occupied(h,b)&&!this.is_player(f)&&
-1===e.inArray(f,c)&&(a=a.add(f),c.push(f))},this))},this));return a};b.on_start_overlapping_column=function(a){this.set_player(a,void 0,!1)};b.on_start_overlapping_row=function(a){this.set_player(void 0,a,!1)};b.on_stop_overlapping_column=function(a){var c=this;this.options.shift_larger_widgets_down&&this.for_each_widget_below(a,this.cells_occupied_by_player.rows[0],function(a,b){c.move_widget_up(this,c.player_grid_data.size_y)})};b.on_stop_overlapping_row=function(a){var c=this,d=this.cells_occupied_by_player.cols;
if(this.options.shift_larger_widgets_down)for(var b=0,e=d.length;b<e;b++)this.for_each_widget_below(d[b],a,function(a,d){c.move_widget_up(this,c.player_grid_data.size_y)})};b.new_move_widget_to=function(a,c,d){var b=a.coords().grid;this.remove_from_gridmap(b);b.row=d;b.col=c;this.add_to_gridmap(b);a.attr("data-row",d);a.attr("data-col",c);this.update_widget_position(b,a);this.$changed=this.$changed.add(a);return this};b.move_widget=function(a,c,d,b){var e=a.coords().grid;c={col:c,row:d,size_x:e.size_x,
size_y:e.size_y};this.mutate_widget_in_gridmap(a,e,c);this.set_dom_grid_height();this.set_dom_grid_width();b&&b.call(this,c.col,c.row);return a};b.move_widget_to=function(a,c){var d=this,b=a.coords().grid,h=this.widgets_below(a);if(!1===this.can_move_to(b,b.col,c))return!1;this.remove_from_gridmap(b);b.row=c;this.add_to_gridmap(b);a.attr("data-row",c);this.$changed=this.$changed.add(a);h.each(function(a,c){var b=e(c),f=b.coords().grid,g=d.can_go_widget_up(f);g&&g!==f.row&&d.move_widget_to(b,g)});
return this};b.move_widget_up=function(a,c){if(void 0===c)return!1;var d=a.coords().grid,b=d.row,h=[];c||(c=1);if(!this.can_go_up(a))return!1;this.for_each_column_occupied(d,function(d){if(-1===e.inArray(a,h)){var f=a.coords().grid,k=b-c;k=this.can_go_up_to_row(f,d,k);if(!k)return!0;this.remove_from_gridmap(f);f.row=k;this.add_to_gridmap(f);a.attr("data-row",f.row);this.$changed=this.$changed.add(a);h.push(a)}})};b.move_widget_down=function(a,c){if(0>=c)return!1;var d=a.coords().grid.row;if(d+(a.coords().grid.size_y-
1)+c>this.options.max_rows)return!1;var b=[];if(!a)return!1;this.failed=!1;if(-1===e.inArray(a,b)){var h=a.coords().grid;d+=c;this.widgets_below(a).each(e.proxy(function(a,d){if(!0!==this.failed){var b=e(d),f=b.coords().grid;f=this.displacement_diff(f,h,c);0<f&&(this.failed=!1===this.move_widget_down(b,f))}},this));if(this.failed)return!1;this.remove_from_gridmap(h);h.row=d;this.update_widget_position(h,a);a.attr("data-row",h.row);this.$changed=this.$changed.add(a);b.push(a)}return!0};b.can_go_up_to_row=
function(a,c,d){var b=!0,h=[],k=a.row;this.for_each_column_occupied(a,function(a){h[a]=[];for(g=k;g--;)if(this.is_empty(a,g)&&!this.is_placeholder_in(a,g))h[a].push(g);else break;if(!h[a].length)return b=!1,!0});if(!b)return!1;var g=d;for(g=1;g<k;g++){a=!0;c=0;for(d=h.length;c<d;c++)h[c]&&-1===e.inArray(g,h[c])&&(a=!1);if(!0===a){b=g;break}}return b};b.displacement_diff=function(a,c,d){var b=a.row,e=[],k=c.row+c.size_y;this.for_each_column_occupied(a,function(a){for(var c=0,d=k;d<b;d++)this.is_empty(a,
d)&&(c+=1);e.push(c)});a=Math.max.apply(Math,e);d-=a;return 0<d?d:0};b.widgets_below=function(a){var c=e([]);a=e.isPlainObject(a)?a:a.coords().grid;if(void 0===a)return c;var d=this,b=a.row+a.size_y-1;this.for_each_column_occupied(a,function(a){d.for_each_widget_below(a,b,function(a,b){if(!d.is_player(this)&&-1===e.inArray(this,c))return c=c.add(this),!0})});return m.sort_by_row_asc(c)};b.set_cells_player_occupies=function(a,c){this.remove_from_gridmap(this.placeholder_grid_data);this.placeholder_grid_data.col=
a;this.placeholder_grid_data.row=c;this.add_to_gridmap(this.placeholder_grid_data,this.$player);return this};b.empty_cells_player_occupies=function(){this.remove_from_gridmap(this.placeholder_grid_data);return this};b.can_go_down=function(a){var c=!0,d=this;a.hasClass(this.options.static_class)&&(c=!1);this.widgets_below(a).each(function(){e(this).hasClass(d.options.static_class)&&(c=!1)});return c};b.can_go_up=function(a){a=a.coords().grid;var c=a.row,d=c-1,b=!0;if(1===c)return!1;this.for_each_column_occupied(a,
function(a){if(this.is_occupied(a,d)||this.is_player(a,d)||this.is_placeholder_in(a,d)||this.is_player_in(a,d))return b=!1,!0});return b};b.can_move_to=function(a,c,d){var b=a.el,e=!0;if(Infinity!==this.options.max_cols&&c+a.size_x-1>this.cols||this.options.max_rows<d+a.size_y-1)return!1;this.for_each_cell_occupied({size_y:a.size_y,size_x:a.size_x,col:c,row:d},function(c,d){var f=this.is_widget(c,d);!f||a.el&&!f.is(b)||(e=!1)});return e};b.get_targeted_columns=function(a){for(var c=(a||this.player_grid_data.col)+
(this.player_grid_data.size_x-1),d=[];a<=c;a++)d.push(a);return d};b.get_targeted_rows=function(a){for(var c=(a||this.player_grid_data.row)+(this.player_grid_data.size_y-1),d=[];a<=c;a++)d.push(a);return d};b.get_cells_occupied=function(a,c){var d={cols:[],rows:[]},b;c instanceof e&&(a=c.coords().grid);for(b=0;b<a.size_x;b++)d.cols.push(a.col+b);for(b=0;b<a.size_y;b++)d.rows.push(a.row+b);return d};b.for_each_cell_occupied=function(a,c){this.for_each_column_occupied(a,function(d){this.for_each_row_occupied(a,
function(a){c.call(this,d,a)})});return this};b.for_each_column_occupied=function(a,c){for(var d=0;d<a.size_x;d++)c.call(this,a.col+d,a)};b.for_each_row_occupied=function(a,c){for(var d=0;d<a.size_y;d++)c.call(this,a.row+d,a)};b.clean_up_changed=function(){var a=this;a.$changed.each(function(){a.options.shift_larger_widgets_down&&a.move_widget_up(e(this))})};b._traversing_widgets=function(a,c,d,b,h){var f=this.gridmap;if(f[d]){var g,l;a=a+"/"+c;d instanceof e&&(c=d.coords().grid,d=c.col,h=b=c.row);
var m=[],p=b;c={"for_each/above":function(){for(;p--&&!(0<p&&this.is_widget(d,p)&&-1===e.inArray(f[d][p],m)&&(g=h.call(f[d][p],d,p),m.push(f[d][p]),g)););},"for_each/below":function(){p=b+1;for(l=f[d].length;p<l;p++)this.is_widget(d,p)&&-1===e.inArray(f[d][p],m)&&(g=h.call(f[d][p],d,p),m.push(f[d][p]))}};c[a]&&c[a].call(this)}};b.for_each_widget_above=function(a,c,d){this._traversing_widgets("for_each","above",a,c,d);return this};b.for_each_widget_below=function(a,c,d){this._traversing_widgets("for_each",
"below",a,c,d);return this};b.get_highest_occupied_cell=function(){var a=this.gridmap;for(var c=a[1].length,d=[],b=[],e=a.length-1;1<=e;e--)for(a=c-1;1<=a;a--)if(this.is_widget(e,a)){d.push(a);b.push(e);break}return{col:Math.max.apply(Math,b),row:Math.max.apply(Math,d)}};b.get_widgets_in_range=function(a,c,d,b){var f=e([]),k,g;for(k=d;k>=a;k--)for(g=b;g>=c;g--){var l=this.is_widget(k,g);if(!1!==l){var m=l.data("coords").grid;m.col>=a&&m.col<=d&&m.row>=c&&m.row<=b&&(f=f.add(l))}}return f};b.get_widgets_at_cell=
function(a,c){return this.get_widgets_in_range(a,c,a,c)};b.get_widgets_from=function(a,c){var d=e();a&&(d=d.add(this.$widgets.filter(function(){var c=parseInt(e(this).attr("data-col"));return c===a||c>a})));c&&(d=d.add(this.$widgets.filter(function(){var a=parseInt(e(this).attr("data-row"));return a===c||a>c})));return d};b.set_dom_grid_height=function(a){"undefined"===typeof a&&(a=this.get_highest_occupied_cell().row,a=(a+1)*this.options.widget_margins[1]+a*this.min_widget_height);this.container_height=
a;this.$el.css("height",this.container_height);return this};b.set_dom_grid_width=function(a){"undefined"===typeof a&&(a=this.get_highest_occupied_cell().col);a=Math.min(Infinity===this.options.max_cols?this.options.max_cols:this.cols,Math.max(a,this.options.min_cols));this.container_width=(a+1)*this.options.widget_margins[0]+a*this.min_widget_width;if(this.is_responsive())return this.$el.css({"min-width":"100%","max-width":"100%"}),this;this.$el.css("width",this.container_width);return this};b.is_responsive=
function(){return this.options.autogenerate_stylesheet&&"auto"===this.options.widget_base_dimensions[0]&&Infinity!==this.options.max_cols};b.get_responsive_col_width=function(){var a=this.cols||this.options.max_cols;return(this.$el[0].clientWidth-3-(a+1)*this.options.widget_margins[0])/a};b.resize_responsive_layout=function(){this.min_widget_width=this.get_responsive_col_width();this.generate_stylesheet();this.update_widgets_dimensions();this.drag_api.set_limits(this.cols*this.min_widget_width+(this.cols+
1)*this.options.widget_margins[0]);return this};b.toggle_collapsed_grid=function(a,c){a?(this.$widgets.css({"margin-top":c.widget_margins[0],"margin-bottom":c.widget_margins[0],"min-height":c.widget_base_dimensions[1]}),this.$el.addClass("collapsed"),this.resize_api&&this.disable_resize(),this.drag_api&&this.disable()):(this.$widgets.css({"margin-top":"auto","margin-bottom":"auto","min-height":"auto"}),this.$el.removeClass("collapsed"),this.resize_api&&this.enable_resize(),this.drag_api&&this.enable());
return this};b.generate_stylesheet=function(a){var c="",d=this.is_responsive()&&this.options.responsive_breakpoint&&e(window).width()<this.options.responsive_breakpoint;a||(a={});a.cols||(a.cols=this.cols);a.rows||(a.rows=this.rows);a.namespace||(a.namespace=this.options.namespace);a.widget_base_dimensions||(a.widget_base_dimensions=this.options.widget_base_dimensions);a.widget_margins||(a.widget_margins=this.options.widget_margins);this.is_responsive()&&(a.widget_base_dimensions=[this.get_responsive_col_width(),
a.widget_base_dimensions[1]],this.toggle_collapsed_grid(d,a));var b=e.param(a);if(0<=e.inArray(b,m.generated_stylesheets))return!1;this.generated_stylesheets.push(b);m.generated_stylesheets.push(b);for(b=1;b<=a.cols+1;b++)c+=a.namespace+' [data-col="'+b+'"] { left:'+(d?this.options.widget_margins[0]:b*a.widget_margins[0]+(b-1)*a.widget_base_dimensions[0])+"px; }\n";for(b=1;b<=a.rows+1;b++)c+=a.namespace+' [data-row="'+b+'"] { top:'+(b*a.widget_margins[1]+(b-1)*a.widget_base_dimensions[1])+"px; }\n";
for(b=1;b<=a.rows;b++)c+=a.namespace+' [data-sizey="'+b+'"] { height:'+(d?"auto":b*a.widget_base_dimensions[1]+(b-1)*a.widget_margins[1])+(d?"":"px")+"; }\n";for(b=1;b<=a.cols;b++){var h=b*a.widget_base_dimensions[0]+(b-1)*a.widget_margins[0];c+=a.namespace+' [data-sizex="'+b+'"] { width:'+(d?this.$wrapper.width()-2*this.options.widget_margins[0]:h>this.$wrapper.width()?this.$wrapper.width():h)+"px; }\n"}this.remove_style_tags();return this.add_style_tag(c)};b.add_style_tag=function(a){var c=document,
b="gridster-stylesheet";""!==this.options.namespace&&(b=b+"-"+this.options.namespace);if(!document.getElementById(b)){var e=c.createElement("style");e.id=b;c.getElementsByTagName("head")[0].appendChild(e);e.setAttribute("type","text/css");e.styleSheet?e.styleSheet.cssText=a:e.appendChild(document.createTextNode(a));this.remove_style_tags();this.$style_tags=this.$style_tags.add(e)}return this};b.remove_style_tags=function(){var a=m.generated_stylesheets,c=this.generated_stylesheets;this.$style_tags.remove();
m.generated_stylesheets=e.map(a,function(a){if(-1===e.inArray(a,c))return a})};b.generate_faux_grid=function(a,c){this.faux_grid=[];this.gridmap=[];var b,e;for(b=c;0<b;b--)for(this.gridmap[b]=[],e=a;0<e;e--)this.add_faux_cell(e,b);return this};b.add_faux_cell=function(a,b){var c=e({left:this.baseX+(b-1)*this.min_widget_width,top:this.baseY+(a-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:b,row:a,original_col:b,original_row:a}).coords();e.isArray(this.gridmap[b])||
(this.gridmap[b]=[]);"undefined"===typeof this.gridmap[b][a]&&(this.gridmap[b][a]=!1);this.faux_grid.push(c);return this};b.add_faux_rows=function(a){a=window.parseInt(a,10);for(var b=this.rows,d=a=b+parseInt(a||1);d>b;d--)for(var e=this.cols;1<=e;e--)this.add_faux_cell(d,e);this.rows=a;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this};b.add_faux_cols=function(a){a=window.parseInt(a,10);var b=this.cols;a=b+parseInt(a||1);a=Math.min(a,this.options.max_cols);for(b+=1;b<=
a;b++)for(var d=this.rows;1<=d;d--)this.add_faux_cell(d,b);this.cols=a;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this};b.recalculate_faux_grid=function(){var a=this.$wrapper.width();this.baseX=(t.width()-a)/2;this.baseY=this.$wrapper.offset().top;"relative"===this.$wrapper.css("position")&&(this.baseX=this.baseY=0);e.each(this.faux_grid,e.proxy(function(a,b){this.faux_grid[a]=b.update({left:this.baseX+(b.data.col-1)*this.min_widget_width,top:this.baseY+(b.data.row-1)*
this.min_widget_height})},this));this.is_responsive()&&this.resize_responsive_layout();this.options.center_widgets&&this.center_widgets();return this};b.resize_widget_dimensions=function(a){a.widget_margins&&(this.options.widget_margins=a.widget_margins);a.widget_base_dimensions&&(this.options.widget_base_dimensions=a.widget_base_dimensions);this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0];this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1];
this.$widgets.each(e.proxy(function(a,b){var c=e(b);this.resize_widget(c)},this));this.generate_grid_and_stylesheet();this.get_widgets_from_DOM();this.set_dom_grid_height();this.set_dom_grid_width();return this};b.get_widgets_from_DOM=function(){var a=this.$widgets.map(e.proxy(function(a,b){var c=e(b);return this.dom_to_coords(c)},this));a=m.sort_by_row_and_col_asc(a);e(a).map(e.proxy(function(a,b){return this.register_widget(b)||null},this)).length&&this.$el.trigger("gridster:positionschanged");
return this};b.get_num_widgets=function(){return this.$widgets.size()};b.set_num_columns=function(a){var b=this.options.max_cols;a=Math.floor(a/(this.min_widget_width+this.options.widget_margins[0]))+this.options.extra_cols;var d=this.$widgets.map(function(){return e(this).attr("data-col")}).get();d.length||(d=[0]);d=Math.max.apply(Math,d);this.cols=Math.max(d,a,this.options.min_cols);Infinity!==b&&b>=d&&b<this.cols&&(this.cols=b);this.drag_api&&this.drag_api.set_limits(this.cols*this.min_widget_width+
(this.cols+1)*this.options.widget_margins[0])};b.set_new_num_rows=function(a){var b=this.options.max_rows,d=this.$widgets.map(function(){return e(this).attr("data-row")}).get();d.length||(d=[0]);d=Math.max.apply(Math,d);this.rows=Math.max(d,a,this.options.min_rows);Infinity!==b&&(b<d||b<this.rows)&&(b=this.rows);this.min_rows=d;this.max_rows=b;this.options.max_rows=b;a=this.rows*this.min_widget_height+(this.rows+1)*this.options.widget_margins[1];this.drag_api&&(this.drag_api.options.container_height=
a);this.container_height=a;this.generate_faux_grid(this.rows,this.cols)};b.generate_grid_and_stylesheet=function(){var a=this.$wrapper.width();this.set_num_columns(a);var b=this.options.extra_rows;this.$widgets.each(function(a,c){b+=+e(c).attr("data-sizey")});this.rows=this.options.max_rows;this.baseX=(t.width()-a)/2;this.baseY=this.$wrapper.offset().top;this.options.autogenerate_stylesheet&&this.generate_stylesheet();return this.generate_faux_grid(this.rows,this.cols)};b.destroy=function(a){this.$el.removeData("gridster");
e.each(this.$widgets,function(){e(this).removeData("coords")});t.unbind(".gridster");this.drag_api&&this.drag_api.destroy();this.resize_api&&this.resize_api.destroy();this.$widgets.each(function(a,b){e(b).coords().destroy()});this.resize_api&&this.resize_api.destroy();this.remove_style_tags();a&&this.$el.remove();return this};e.fn.gridster=function(a){return this.each(function(){var b=e(this);b.data("gridster")||b.data("gridster",new m(this,a))})};return m});